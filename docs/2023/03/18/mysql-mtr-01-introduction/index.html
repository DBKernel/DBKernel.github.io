<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="DBKernel" />



<meta name="description" content="作者：卢文双 资深数据库内核研发  去年年底通过微信公众号【数据库内核】设定了一个目标——2023 年要写一系列 特性介绍+内核解析 的文章（现阶段还是以 MySQL 为主）。虽然关注者很少，但本着“说到就要做到”的原则，从这篇就开始了。  序言： 以前对 MySQL 测试框架 MTR 的使用，主要集中于 SQL 正确性验证。近期由于工作需要，深入了解了 MTR 的方方面面，发现 MTR 的能力不">
<meta property="og:type" content="article">
<meta property="og:title" content="特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇">
<meta property="og:url" content="http://dbkernel.github.io/2023/03/18/mysql-mtr-01-introduction/index.html">
<meta property="og:site_name" content="DBKernel">
<meta property="og:description" content="作者：卢文双 资深数据库内核研发  去年年底通过微信公众号【数据库内核】设定了一个目标——2023 年要写一系列 特性介绍+内核解析 的文章（现阶段还是以 MySQL 为主）。虽然关注者很少，但本着“说到就要做到”的原则，从这篇就开始了。  序言： 以前对 MySQL 测试框架 MTR 的使用，主要集中于 SQL 正确性验证。近期由于工作需要，深入了解了 MTR 的方方面面，发现 MTR 的能力不">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dbkernel-1306518848.cos.ap-beijing.myqcloud.com/wechat/my-wechat-official-account.png">
<meta property="article:published_time" content="2023-03-18T13:58:52.000Z">
<meta property="article:modified_time" content="2023-04-17T15:29:31.671Z">
<meta property="article:author" content="DBKernel">
<meta property="article:tag" content="MySQL">
<meta property="article:tag" content="测试框架">
<meta property="article:tag" content="MTR">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dbkernel-1306518848.cos.ap-beijing.myqcloud.com/wechat/my-wechat-official-account.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="DBKernel" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">




<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇 | DBKernel</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 5.4.2"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">DBKernel</a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>返回菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:wenshuang_lu@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" rel="noopener" href="https://github.com/dbkernel" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" target="_blank" rel="noopener" href="https://www.zhihu.com/people/dbkernel/posts" title="知乎"></a>
                            
                                <a class="fa SegmentFault" target="_blank" rel="noopener" href="https://segmentfault.com/u/dbkernel" title="SegmentFault"></a>
                            
                                <a class="fa 博客园" target="_blank" rel="noopener" href="https://www.cnblogs.com/dbkernel" title="博客园"></a>
                            
                                <a class="fa CSDN" target="_blank" rel="noopener" href="https://blog.csdn.net/dbkernel" title="CSDN"></a>
                            
                                <a class="fa 掘金" target="_blank" rel="noopener" href="https://juejin.im/user/5e9d3ed251882538083fed1f/posts" title="掘金"></a>
                            
                                <a class="fa 网易云音乐" target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=2109792568" title="网易云音乐"></a>
                            
                                <a class="fa QQ" target="_blank" rel="noopener" href="https://dbkernel-1306518848.cos.ap-beijing.myqcloud.com/qq/qq-mysql-group.jpeg" title="QQ"></a>
                            
                                <a class="fa 微信" href="https://dbkernel.github.io/images/wechat-gzh.jpeg" title="微信"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/APUE/" rel="tag">APUE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/B-Tree/" rel="tag">B-Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClickHouse/" rel="tag">ClickHouse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClickHouse%E5%92%8C%E4%BB%96%E7%9A%84%E6%9C%8B%E5%8F%8B%E4%BB%AC/" rel="tag">ClickHouse和他的朋友们</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Count/" rel="tag">Count</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag">C语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DAG-Scheduler/" rel="tag">DAG Scheduler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GreenPlum/" rel="tag">GreenPlum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HEAP%E5%BC%95%E6%93%8E/" rel="tag">HEAP引擎</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LF-HASH/" rel="tag">LF_HASH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LICENCE/" rel="tag">LICENCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSM-Tree/" rel="tag">LSM-Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MEMORY%E5%BC%95%E6%93%8E/" rel="tag">MEMORY引擎</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MTR/" rel="tag">MTR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/" rel="tag">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Materialized-View/" rel="tag">Materialized View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MergeTree/" rel="tag">MergeTree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Parser/" rel="tag">Parser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Percona/" rel="tag">Percona</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgres-X2/" rel="tag">Postgres-X2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgres-XC/" rel="tag">Postgres-XC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RadonDB/" rel="tag">RadonDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReplicatedMergeTree/" rel="tag">ReplicatedMergeTree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Select/" rel="tag">Select</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StoneDB/" rel="tag">StoneDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UNIX/" rel="tag">UNIX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WAL/" rel="tag">WAL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xenon/" rel="tag">Xenon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xtrabackup/" rel="tag">Xtrabackup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auto-increment/" rel="tag">auto_increment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/crontab/" rel="tag">crontab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/daemon/" rel="tag">daemon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/df/" rel="tag">df</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/du/" rel="tag">du</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc/" rel="tag">gcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcov/" rel="tag">gcov</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/getopt/" rel="tag">getopt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/group-by/" rel="tag">group by</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lcov/" rel="tag">lcov</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libpq/" rel="tag">libpq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg-constraint/" rel="tag">pg_constraint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg-depend/" rel="tag">pg_depend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pgbench/" rel="tag">pgbench</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipeline/" rel="tag">pipeline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/processor/" rel="tag">processor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5/" rel="tag">主从同步</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%98%E5%8C%96%E5%99%A8/" rel="tag">优化器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" rel="tag">内存分配</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">内存管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%9E%E5%BD%92%E6%B5%8B%E8%AF%95/" rel="tag">回归测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E5%AF%B9%E9%BD%90/" rel="tag">字节对齐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E5%BA%8F/" rel="tag">字节序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%98%E5%82%A8%E8%AE%A1%E7%AE%97%E5%88%86%E7%A6%BB/" rel="tag">存储计算分离</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E8%A1%8C%E6%9F%A5%E8%AF%A2/" rel="tag">并行查询</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E5%8D%8F%E8%AE%AE/" rel="tag">开源协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E6%BA%90%E8%AE%B8%E5%8F%AF%E8%AF%81/" rel="tag">开源许可证</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%AC%E5%9C%B0%E4%BA%8B%E5%8A%A1/" rel="tag">本地事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/" rel="tag">测试框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="tag">源码分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/" rel="tag">系统运维</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/" rel="tag">编译器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%BA%8F/" rel="tag">网络序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" rel="tag">网络编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/" rel="tag">问题定位</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://dbkernel.github.io/">GitHub</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">目前从事云数据库MySQL数据库内核研发工作，曾做过Postgres-XC、Greenplum等分布式数据库的内核开发。热衷于研究主流数据库架构、源码，对关系型数据库 MySQL/PostgreSQL及分布式数据库有深入研究。</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">DBKernel</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">DBKernel</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:wenshuang_lu@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/dbkernel" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/dbkernel/posts" title="知乎"></a>
                            
                                <a class="fa SegmentFault" target="_blank" href="https://segmentfault.com/u/dbkernel" title="SegmentFault"></a>
                            
                                <a class="fa 博客园" target="_blank" href="https://www.cnblogs.com/dbkernel" title="博客园"></a>
                            
                                <a class="fa CSDN" target="_blank" href="https://blog.csdn.net/dbkernel" title="CSDN"></a>
                            
                                <a class="fa 掘金" target="_blank" href="https://juejin.im/user/5e9d3ed251882538083fed1f/posts" title="掘金"></a>
                            
                                <a class="fa 网易云音乐" target="_blank" href="https://music.163.com/#/user/home?id=2109792568" title="网易云音乐"></a>
                            
                                <a class="fa QQ" target="_blank" href="https://dbkernel-1306518848.cos.ap-beijing.myqcloud.com/qq/qq-mysql-group.jpeg" title="QQ"></a>
                            
                                <a class="fa 微信" target="_blank" href="https://dbkernel.github.io/images/wechat-gzh.jpeg" title="微信"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-mysql-mtr-01-introduction" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2023/03/18/mysql-mtr-01-introduction/" class="article-date">
      <time datetime="2023-03-18T13:58:52.000Z" itemprop="datePublished">2023-03-18</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MTR/" rel="tag">MTR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/" rel="tag">测试框架</a></li></ul>
    </div>

        <br></br> <!--字数统计另起一行-->
        
	
		<span class="post-wordcount" itemprop="wordCount">
			字数统计: 9.6k(字) </a>
		</span>
	
	
		<span class="post-readcount" itemprop="timeRequired">
			阅读时长: 45(分)
		</span>
	

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <p><strong>作者：卢文双 资深数据库内核研发</strong></p>
<blockquote>
<p>去年年底通过微信公众号【数据库内核】设定了一个目标——2023 年要写一系列 特性介绍+内核解析 的文章（现阶段还是以 MySQL 为主）。<br>虽然关注者很少，但本着“说到就要做到”的原则，从这篇就开始了。</p>
</blockquote>
<p><strong>序言：</strong></p>
<p>以前对 MySQL 测试框架 MTR 的使用，主要集中于 SQL 正确性验证。近期由于工作需要，深入了解了 MTR 的方方面面，发现 MTR 的能力不仅限于此，还支持单元测试、压力测试、代码覆盖率测试、内存错误检测、线程竞争与死锁等功能，因此，本着分享的精神，将其总结成一个系列。</p>
<p>主要内容如下：</p>
<ul>
<li>入门篇：工作机制、编译安装、参数、指令示例、推荐用法、添加 case、常见问题、异常调试</li>
<li>进阶篇：高阶用法，包括单元测试、压力测试、代码覆盖率测试、内存错误检测、线程竞争与死锁</li>
<li>源码篇：分析 MTR 的源码</li>
<li>语法篇：单元测试、压力测试、mysqltest 语法、异常调试</li>
</ul>
<p>由于个人水平有限，所述难免有错误之处，望雅正。</p>
<p><strong>本文是第一篇入门篇</strong>。</p>
<span id="more"></span>

<blockquote>
<p><strong>本文首发于 2023-03-18 21:58:52</strong></p>
</blockquote>
<hr>
<p>本系列基于 MySQL 8.0.29 版本，且主要在 Ubuntu 22.04 X86_64 验证（部分指令也在 Ubuntu 20.04 X86_64、Ubuntu 22.04 ARM64、MacOS M1 做了验证），如有例外，会特别说明。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在修改内核代码后，不仅需要测试新增功能，同时也要对原有功能做回归测试，以保证新加代码对原有功能没有影响，这就需要用到 MySQL 源码自带的测试框架 mtr。</p>
<p>MySQL 测试框架是一个以 MySQL 框架和内部引擎为测试对象的工具，主要执行脚本在安装路径（<code>make install</code>后的路径）下的<code>mysql-test</code>目录，基本覆盖了所有 MySQL 的特性和异常情况。</p>
<p><strong>MySQL 测试框架 mtr 主要包含如下几个组件：</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a> ：perl 脚本，简称 <strong>mtr</strong>，是 MySQL 最常用的测试工具，负责控制流程，包括启停、识别执行哪些用例、创建文件夹、收集结果等等，主要作用是验证 SQL 语句在各种场景下是否返回正确的结果。</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQLTEST.html">mysqltest</a> ：C++二进制程序，负责执行测试用例，包括读文件、解析特定语法、执行用例。<ul>
<li>用例的特殊语法（比如，<code>--source</code>，<code>--replace_column</code>等）都在<code>command_names</code>和<code>enum_commands</code>两个枚举结构体中。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQL_CLIENT_TEST.html">mysql_client_test</a> ：C++二进制程序，用于测试 MySQL 客户端 API（<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQLTEST.html">mysqltest</a> 无法用于测试 API）。<ul>
<li>从代码看，只有启用<code>--valgrind</code> 或 <code>--valgrind-mysqltest</code> 选项，才会用到 <code>mysql_client_test</code> 。</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQL_STRESS_TEST_PL.html">mysql-stress-test.pl</a> ：perl 脚本，用于 MySQL Server 的压力测试。</li>
<li>支持 gcov/gprof 代码覆盖率测试工具。</li>
</ul>
<p>除此之外，还提供了单元测试工具（严格来说不属于 mtr ），以便为存储引擎和插件创建单独的单元测试程序。</p>
<p><strong>由于 MySQL 测试框架的入口是 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQL_TEST_RUN_PL.html">mysql-test-run.pl</a>（它会调用上述其他组件），因此，一般将 MySQL 测试框架简称为 mtr</strong>。</p>
<h1 id="mtr-工作原理"><a href="#mtr-工作原理" class="headerlink" title="mtr 工作原理"></a>mtr 工作原理</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>mtr 采用<code>t/r</code>模式（<code>t</code>目录中存储具体的测试 case，文件以<code>.test</code>结尾；<code>r</code>目录中存储了对应 case 的期望结果，文件以<code>.result</code>结尾），主要测试步骤是“通过执行一个 case，将该 case 的输出结果，与标准的输出结果（期望结果）作 diff”：</p>
<ul>
<li>如果完全一样，则说明该 case 通过；</li>
<li>反之，则说明该 case 失败。<ul>
<li>可能原因：case 本身写的有问题；MySQL 服务有问题。</li>
</ul>
</li>
</ul>
<p>如果<code>t</code>目录中的某个 case 在<code>r</code>目录中没有对应<code>.result</code>文件：</p>
<ul>
<li>那么，只要该 case 能正常执行完，mtr 就会判定该 case 通过；</li>
<li>反之，若执行过程中出现 mysql server crash 等异常问题，mtr 就会判定该 case 失败。</li>
</ul>
<p>上文说的 case 是指一系列的语句，包括 SQL 语句和一些必要的 mysqltest command。</p>
<p>所有 case 可分为三部分，分别为：</p>
<ul>
<li><strong>main</strong>：测试 case 位于 <code>mysql-test/t</code> 目录，期望结果（如果有的话）位于<code>mysql-test/r</code> 目录，二者中的文件是一一对应的，比如：<code>mysql-test/t/alter_debug.test</code> 、<code>mysql-test/r/alter_debug.result</code>。</li>
<li><strong>suite</strong> ：路径位于<code>mysql-test/suite</code> 目录，其中包含很多测试 case 的集合，每个集合都是一个单独的子目录（比如 <code>mysql-test/suite/binlog</code>），在子目录中又分别包含 r、t 两个目录。</li>
<li><strong>extra</strong> ：应该是对上述两种 case 的补充，位于<code>mysql-test/extra/</code> 目录，在 8.0.29 版本中只包含<code>binlog_tests</code>、<code>rpl_tests</code> 两个集合。</li>
</ul>
<h2 id="框架流程"><a href="#框架流程" class="headerlink" title="框架流程"></a>框架流程</h2><p><code>mysql-test-run.pl</code>框架运行流程如下：</p>
<p>1、<strong>初始化（Initialization）</strong>。</p>
<ul>
<li>确定用例执行范围，包括运行哪些 suite，skip 哪些用例，在本阶段根据<code>disabled.def</code>文件、<code>--skip-xxx</code>命令（比如<code>skip-rpl</code>）等确定执行用例。</li>
<li>同时，初始化数据库。后面运行用例启动数据库时，不需要每次初始化，只需从这里的目录中拷贝启动。</li>
</ul>
<p>2、<strong>运行用例（run test）</strong>。</p>
<p>主线程根据参数<code>--parallel</code>（默认是 1）启动一个或者多个<strong>用例执行线程（worker）</strong>，各线程有自己独立的 client port，data dir 等。</p>
<p>启动的 worker 与主线程之间是 server-client 模式，主线程是 server，worker 是 client。</p>
<ul>
<li>主线程与 worker 是一问一答模式，主线程向 worker 发送运行用例的文件路径、配置文件参数等各种参数信息，worker 向主线程返回运行结果，直到所有在 collection 中的用例都运行完毕，主线程 close 各 worker，进行收尾工作。</li>
<li>主线程先读取各 worker 返回值，对上一个用例进行收尾工作。之后，读取 collection 中的用例，通过本地 socket 发送到 worker 线程，worker 线程接收到主线程命令，运行本次用例测试的核心逻辑，主要包括 3 件事：<strong>启动 mysqld、启动并监控 mysqltest，处理执行结果</strong>。<ul>
<li><strong>启动 mysqld</strong>： <strong>根据参数启动一个或者多个 mysqld server 进程</strong>，大多数情况下会拷贝主线程初始化后的目录到 worker 的数据目录，作为新实例的启动目录，用 shell 命令启动数据库。</li>
<li><strong>启动并监控 mysqltest</strong>：用例在 mysqltest 中执行（<strong>会逐行扫描 <code>*.test</code> 文件中的 SQL 或指令并于 MySQL 中执行</strong>），worker 线程会监控 mysqltest 的运行状态，监测其是否运行超时或者运行结束。</li>
<li><strong>处理执行结果</strong>：mysqltest 执行结束会留下执行日志，框架根据执行日志判断执行是否通过，如果没通过是否需要重试等。</li>
</ul>
</li>
</ul>
<p>以 <code>rpl.rpl_multi_source_basic</code>（对应于文件 <code>mysql-test/suite/rpl/t/rpl_multi_source_basic.test</code>）测试 case 为例来说明执行过程，用例内容如下（开头注释部分为测试过程）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is the basic test required in for multisource replication</span></span><br><span class="line"><span class="comment"># The aim of this file is to test the basic usecases of msr.</span></span><br><span class="line"><span class="comment"># 0. Create two masters and a slave and setup a multisource replication</span></span><br><span class="line"><span class="comment">#    between them.</span></span><br><span class="line"><span class="comment"># 1. create a different databases on each master and test if they are replicated</span></span><br><span class="line"><span class="comment">#    to the slave.</span></span><br><span class="line"><span class="comment"># 2. create a different table on each master and test if they are replicated to</span></span><br><span class="line"><span class="comment">#    the to the slave.</span></span><br><span class="line"><span class="comment"># 3. Create a table with the same name on both masters and update non conflicting</span></span><br><span class="line"><span class="comment">#    data on that table. Test if the replication is done properly.</span></span><br><span class="line"><span class="comment"># 4. Check if updates happen on different master such that the resulting</span></span><br><span class="line"><span class="comment">#    data on slave is conflicting, check that one of the channels the slave</span></span><br><span class="line"><span class="comment">#    SQL thread is stopped.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note: Out of convention, server 2 is always made a slave for multisource testing.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Skip on group replication runs</span></span><br><span class="line">--<span class="built_in">source</span> include/not_group_replication_plugin.inc</span><br><span class="line"><span class="comment"># Test requires master-info-repository=TABLE, relay-log-info-repository=TABLE</span></span><br><span class="line">--<span class="built_in">source</span> include/have_slave_repository_type_table.inc</span><br><span class="line"></span><br><span class="line">--<span class="built_in">echo</span> <span class="comment">#</span></span><br><span class="line">--<span class="built_in">echo</span> <span class="comment"># set up masters server_1 and server_3 with server_2 being a slave.</span></span><br><span class="line">--<span class="built_in">echo</span> <span class="comment">#.</span></span><br><span class="line">--<span class="built_in">let</span> <span class="variable">$rpl_topology</span>= 1-&gt;2,3-&gt;2</span><br><span class="line">--<span class="built_in">let</span> <span class="variable">$rpl_multi_source</span>= 1</span><br><span class="line">--<span class="built_in">source</span> include/rpl_init.inc</span><br><span class="line"></span><br><span class="line">--<span class="built_in">echo</span> <span class="comment">#</span></span><br><span class="line">--<span class="built_in">echo</span> <span class="comment"># Test case 1: 1.a) create a database and table db1.t1 on server_1</span></span><br><span class="line">--<span class="built_in">echo</span> <span class="comment">#                   and insert values in the table.</span></span><br><span class="line">--<span class="built_in">let</span> <span class="variable">$rpl_connection_name</span>= server_1</span><br><span class="line">--<span class="built_in">source</span> include/rpl_connection.inc</span><br><span class="line">CREATE DATABASE db1;</span><br><span class="line">CREATE TABLE db1.t1 ( a int);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>启动测试指令 <code>perl mysql-test-run.pl --do-test=rpl_multi_source</code> 后，会启动 3 个 mysqld 进程，其中 2 个 master 节点，1 个 slave 节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  rpl ps -xf | grep mysql</span><br><span class="line">   6982 pts/2    S+     0:00      \_ perl mysql-test-run.pl rpl_multi_source_basic</span><br><span class="line">   7125 pts/2    S+     0:00          \_ perl mysql-test-run.pl rpl_multi_source_basic</span><br><span class="line">   7130 pts/2    S+     0:00              \_ /data/work/mysql/mysql80-install.bak_valgrind/bin//mysqltest_safe_process -- /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqld --defaults-group-suffix=.1 --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --log-output=file --loose-debug-sync-timeout=600 --binlog-format=mixed --core-file</span><br><span class="line">   7131 pts/2    Sl     0:04              |   \_ /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqld --defaults-group-suffix=.1 --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --log-output=file --loose-debug-sync-timeout=600 --binlog-format=mixed --core-file</span><br><span class="line">   7132 pts/2    S+     0:00              \_ /data/work/mysql/mysql80-install.bak_valgrind/bin//mysqltest_safe_process -- /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqld --defaults-group-suffix=.2 --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --log-output=file --loose-debug-sync-timeout=600 --binlog-format=mixed --core-file</span><br><span class="line">   7133 pts/2    Sl     0:06              |   \_ /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqld --defaults-group-suffix=.2 --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --log-output=file --loose-debug-sync-timeout=600 --binlog-format=mixed --core-file</span><br><span class="line">   7134 pts/2    S+     0:00              \_ /data/work/mysql/mysql80-install.bak_valgrind/bin//mysqltest_safe_process -- /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqld --defaults-group-suffix=.3 --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --log-output=file --loose-debug-sync-timeout=600 --binlog-format=mixed --core-file</span><br><span class="line">   7135 pts/2    Sl     0:04              |   \_ /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqld --defaults-group-suffix=.3 --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --log-output=file --loose-debug-sync-timeout=600 --binlog-format=mixed --core-file</span><br><span class="line">   7283 pts/2    S+     0:00              \_ /data/work/mysql/mysql80-install.bak_valgrind/bin//mysqltest_safe_process -- /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqltest --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --silent --tmpdir=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/tmp --character-sets-dir=/data/work/mysql/mysql80-install.bak_valgrind/share/charsets --logdir=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/<span class="built_in">log</span> --database=<span class="built_in">test</span> --plugin_dir=/data/work/mysql/mysql80-install.bak_valgrind/lib/plugin --timer-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/<span class="built_in">log</span>/timer --test-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/suite/rpl/t/rpl_multi_source_basic.test --tail-lines=20 --result-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/suite/rpl/r/rpl_multi_source_basic.result</span><br><span class="line">   7284 pts/2    R      0:00                  \_ /data/work/mysql/mysql80-install.bak_valgrind/bin/mysqltest --defaults-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/my.cnf --silent --tmpdir=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/tmp --character-sets-dir=/data/work/mysql/mysql80-install.bak_valgrind/share/charsets --logdir=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/<span class="built_in">log</span> --database=<span class="built_in">test</span> --plugin_dir=/data/work/mysql/mysql80-install.bak_valgrind/lib/plugin --timer-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/var/<span class="built_in">log</span>/timer --test-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/suite/rpl/t/rpl_multi_source_basic.test --tail-lines=20 --result-file=/data/work/mysql/mysql80-install.bak_valgrind/mysql-test/suite/rpl/r/rpl_multi_source_basic.result</span><br></pre></td></tr></table></figure>

<p>可见：</p>
<ol>
<li>无论是 mysqldtest 还是 mysqld，都是由 mysqltest_safe_process 程序启动的。</li>
<li><code>--defaults-group-suffix=.1 到 3</code> 分别对应 3 个 mysqld 进程，说明 <strong>mtr 不是靠 mock 的形式来测试的，而是启动真 mysqld 进程来测试</strong>。</li>
</ol>
<h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p><strong>mysql-server 编译需要：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for mysql 8.0</span></span><br><span class="line"></span><br><span class="line">sudo apt install gdb gcc g++ cmake -y</span><br><span class="line">sudo apt install openssl libssl-dev -y</span><br><span class="line">sudo apt install libncurses-dev libudev-dev -y</span><br><span class="line">sudo apt install bison flex libaio-dev libreadline-dev libjemalloc-dev -y</span><br><span class="line">sudo apt install libevent-dev zlib1g-dev libmecab-dev libgcrypt20-dev -y</span><br><span class="line">sudo apt install libsasl2-dev libldap2-dev libtirpc-dev</span><br><span class="line">sudo apt-get install libsasl2-dev <span class="comment"># SASL</span></span><br><span class="line">sudo apt-get install slapd ldap-utils <span class="comment"># LDAP</span></span><br><span class="line">sudo apt install valgrind doxygen libcurl4-gnutls-dev -y <span class="comment"># extra</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># centos 7.6</span></span><br><span class="line">sudo yum install cmake gcc g++ <span class="comment"># 由于 cmake、gcc 版本偏低，需要自行通过源码编译安装</span></span><br><span class="line">sudo yum install readline-devel bison flex libarchive openssl-devel</span><br><span class="line">sudo yum install rpcgen libudev-devel ncurses-devel libtirpc libtirpc-devel</span><br><span class="line">sudo yum install cyrus-sasl-devel <span class="comment"># SASL</span></span><br><span class="line">sudo yum install openldap openldap-devel <span class="comment"># LDAP</span></span><br><span class="line">sudo yum install valgrind <span class="comment"># extra</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># centos stream 9</span></span><br><span class="line">sudo yum install cmake gcc g++ gcc-toolset-12-gcc gcc-toolset-12-gcc-c++ gcc-toolset-12-binutils</span><br><span class="line">sudo yum install readline-devel bison flex libarchive openssl-devel <span class="comment"># libtirpc-devel</span></span><br><span class="line">sudo yum install rpcgen libudev-devel ncurses-devel libtirpc libtirpc-devel</span><br><span class="line">sudo yum install cyrus-sasl-devel <span class="comment"># SASL</span></span><br><span class="line">sudo yum install openldap openldap-devel <span class="comment"># LDAP</span></span><br><span class="line">sudo yum install valgrind <span class="comment"># extra</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># macos</span></span><br><span class="line">brew install lz4</span><br><span class="line">brew install zlib</span><br><span class="line">brew install clang</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于系统及版本差异，这里罗列的软件包可能会有所缺失，版本也可能会有所不同。</p>
</blockquote>
<p><strong>对于 mtr 来说，也需要额外安装一些依赖：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos</span></span><br><span class="line">yum -y install perl -y</span><br><span class="line">sudo yum install perl-JSON -y</span><br><span class="line">sudo yum install perl-Test-use-ok.noarch -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo apt install perl -y</span><br><span class="line">sudo perl -MCPAN -e <span class="string">&#x27;install JSON&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>Debug 版本编译选项示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for MacOS and Ubuntu</span></span><br><span class="line">CURDIR=`<span class="built_in">pwd</span>`</span><br><span class="line">INSTALLDIR=<span class="variable">$CURDIR</span>/../../mysql80-install</span><br><span class="line">DATADIR=<span class="variable">$CURDIR</span>/../../mysql80-default-data</span><br><span class="line">BOOSTDIR=<span class="variable">$CURDIR</span>/../../boost_1_77_0</span><br><span class="line"></span><br><span class="line">rm CMakeCache.txt -f</span><br><span class="line">cmake .. \</span><br><span class="line">-DCMAKE_BUILD_TYPE=Debug \</span><br><span class="line">-DCMAKE_INSTALL_PREFIX=<span class="variable">$INSTALLDIR</span> \</span><br><span class="line">-DSYSCONFDIR=/etc \</span><br><span class="line">-DMYSQL_DATADIR=<span class="variable">$DATADIR</span> \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \</span><br><span class="line">-DMYSQL_TCP_PORT=3306 \</span><br><span class="line">-DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_DEBUG=1 \ <span class="comment"># 必须是 debug 版本</span></span><br><span class="line">-DWITH_BOOST=<span class="variable">$BOOSTDIR</span> \</span><br><span class="line">-DWITH_SSL=/usr/<span class="built_in">local</span>/openssl-1.1.1 \</span><br><span class="line">-DFORCE_INSOURCE_BUILD=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># -DWITH_ASAN=ON -DWITH_ASAN_SCOPE=ON -DWITH_UBSAN=ON \ # 选择启用哪些组件</span></span><br><span class="line"><span class="comment"># -DWITH_VALGRIND=ON \</span></span><br><span class="line"><span class="comment"># -DENABLE_GCOV=1 -DENABLE_GPROF=1 \</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for MacOS, only need make</span></span><br><span class="line">make -j4</span><br><span class="line">make install</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Release 版本编译选项示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># for MacOS and Ubuntu</span></span><br><span class="line">CURDIR=`<span class="built_in">pwd</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># for 8.0.29</span></span><br><span class="line">INSTALLDIR=<span class="variable">$CURDIR</span>/../../mysql80-install</span><br><span class="line"><span class="comment">#INSTALLDIR=/usr</span></span><br><span class="line">DATADIR=<span class="variable">$CURDIR</span>/../../mysql80-default-data</span><br><span class="line">BOOSTDIR=<span class="variable">$CURDIR</span>/../../boost_1_77_0</span><br><span class="line"></span><br><span class="line">rm CMakeCache.txt -f</span><br><span class="line">cmake .. \</span><br><span class="line">-DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">-DBUILD_CONFIG=mysql_release \</span><br><span class="line">-DFEATURE_SET=community \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=OFF \</span><br><span class="line">-DWITHOUT_ROCKSDB=ON \</span><br><span class="line">-DWITH_UNIT_TESTS=OFF \</span><br><span class="line">-DWITH_BOOST=<span class="variable">$BOOSTDIR</span> \</span><br><span class="line">-DFORCE_INSOURCE_BUILD=1 \</span><br><span class="line">-DCOMPILATION_COMMENT=<span class="string">&quot;MySQL build <span class="subst">$(date +%Y%m%d.%H%M%S.$(git rev-parse --short HEAD)</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-DCMAKE_INSTALL_PREFIX=$INSTALLDIR \</span></span><br><span class="line"><span class="comment">#-DSYSCONFDIR=/etc \</span></span><br><span class="line"><span class="comment">#-DMYSQL_DATADIR=$DATADIR \</span></span><br><span class="line"><span class="comment">#-DWITH_MYISAM_STORAGE_ENGINE=1 \</span></span><br><span class="line"><span class="comment">#-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span></span><br><span class="line"><span class="comment">#-DWITH_MEMORY_STORAGE_ENGINE=1 \</span></span><br><span class="line"><span class="comment">#-DWITH_PARTITION_STORAGE_ENGINE=1 \</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># for MacOS, only need make</span></span><br><span class="line">make -j4</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/source-configuration-options.html#option_cmake_cmake_build_type"><code>-DCMAKE_BUILD_TYPE=type</code></a> 选项说明：</p>
<p>The type of build to produce:</p>
<ul>
<li><code>RelWithDebInfo</code>: <strong>default value</strong>。<strong>Enable optimizations and generate debugging information</strong>. This is the default MySQL build type.</li>
<li><code>Release</code>: Enable optimizations but omit debugging information to reduce the build size. <strong>This build type was added in MySQL 8.0.13</strong> (MySQL 5.7 is not supported).</li>
<li><code>Debug</code>: Disable optimizations and generate debugging information. This build type is also used if the <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/source-configuration-options.html#option_cmake_with_debug"><code>WITH_DEBUG</code></a> option is enabled. That is, <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/source-configuration-options.html#option_cmake_with_debug"><code>-DWITH_DEBUG=1</code></a> has the same effect as <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/source-configuration-options.html#option_cmake_cmake_build_type"><code>-DCMAKE_BUILD_TYPE=Debug</code></a>.</li>
</ul>
<h1 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h1><p>编译安装后，<code>mysql-test</code> 目录树结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">mysql-test</span><br><span class="line">├── README</span><br><span class="line">├── README.gcov <span class="comment"># 代码覆盖率测试说明，最后更新于2006年</span></span><br><span class="line">├── README.stress <span class="comment"># 压力测试说明，针对 mysql-stress-test.pl ，最后更新于2006年</span></span><br><span class="line"></span><br><span class="line">├── collections <span class="comment"># 该目录下的文件是官方推荐的回归测试指令集</span></span><br><span class="line">│   ├── README <span class="comment"># 说明文档</span></span><br><span class="line">│   ├── coverage.ignore <span class="comment"># 指定需要忽略代码覆盖率测试的目录</span></span><br><span class="line">│   ├── disabled.def <span class="comment"># 列出需要临时禁用的测试用例，在运行测试时会跳过</span></span><br><span class="line">│   ├── disabled-asan.list <span class="comment"># 除 disabled.def 文件所列用例之外，还需要临时禁用的测试用例</span></span><br><span class="line">│   ├── disabled-ubsan.list <span class="comment"># 同上</span></span><br><span class="line">│   ├── disabled-valgrind.list <span class="comment"># 同上</span></span><br><span class="line">│   ├── disabled_ndb.def <span class="comment"># 仅在运行 MySQL Cluster 时才需要临时禁用的测试用例</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 适合每天都运行的回归测试指令集</span></span><br><span class="line">        <span class="comment"># 涵盖 default suites、非 default suites、针对复制和binlog的扩展测试（区分不同的复制参数）、InnoDB 扩展测试（区分不同页面大小）</span></span><br><span class="line">│   ├── default.daily</span><br><span class="line">        <span class="comment"># 由于 valgrind 运行比较耗时，因此，该指令集只能涵盖除 big-test 之外的所有 suites 。</span></span><br><span class="line">        <span class="comment"># 需要编译时添加选项 -DWITH_DEBUG=1 -DWITH_VALGRIND=1 的情况下，才能执行 valgrind 测试。</span></span><br><span class="line">        <span class="comment"># 注意：通过实测、分析代码，运行 mtr 时必须添加 --valgrind 选项才能用到 valgrind 组件。</span></span><br><span class="line">│   ├── default.daily-valgrind</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 适合每周运行一次的指令集，运行耗时能达到48小时。</span></span><br><span class="line">        <span class="comment"># 是 default.daily 的超集，同时，还指定了 --debug-server 。</span></span><br><span class="line">        <span class="comment"># 覆盖 default suites + 非 default suites + 复制和binlog的扩展 + InnoDB扩展 + 其他按周运行的指令集。</span></span><br><span class="line">│   ├── default.weekly</span><br><span class="line">│   ├── default.weekly-ndbcluster <span class="comment"># 覆盖 default.daily + ndbcluster + 部分非默认指令集</span></span><br><span class="line">│   ├── default.weekly-protocol <span class="comment"># 编译时需要设置 DWITH_TEST_TRACE_PLUGIN=1，只覆盖 main suite。</span></span><br><span class="line">        <span class="comment"># 在启用 --big-test 和 --debug-server 选项的前提下，运行所有的指令集。</span></span><br><span class="line">        <span class="comment"># 需要编译时添加选项 -DWITH_DEBUG=1 -DWITH_VALGRIND=1 的情况下，才能执行 valgrind 测试。</span></span><br><span class="line">        <span class="comment"># 注意：通过实测、分析代码，运行 mtr 时必须添加 --valgrind 选项才能用到 valgrind 组件。</span></span><br><span class="line">│   ├── default.weekly-valgrind</span><br><span class="line">│   ├── default.weekly.basic <span class="comment"># 在禁用 --big-test 选项的前提下，运行所有的指令集，即包含 default suites + 非 default suites。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 适用于每次push代码时运行的指令集，能控制在一个小时内。</span></span><br><span class="line">        <span class="comment"># 更适用于 mysql 5.7 版本。</span></span><br><span class="line">│   ├── default.push</span><br><span class="line">│   ├── default.push-ndbcluster <span class="comment"># 分为 default suites + 与 ndbcluster 相关的指令集</span></span><br><span class="line">│   ├── default.push-valgrind <span class="comment"># 分为 default suites（排除 rpl）+ ndb 相关 suites + group_replication suite</span></span><br><span class="line">│   ├── mysql-8.0-stage.push <span class="comment"># 在 default.push 基础上，为 mysql-8.0-stage 扩展的测试用例，在merge到main分支前使用</span></span><br><span class="line">│   ├── mysql-8.0-stage.push.basic <span class="comment"># mysql-8.0-stage.push 的子集</span></span><br><span class="line"></span><br><span class="line">│   ├── mysql-trunk-meb-itch.push <span class="comment"># 文件为空</span></span><br><span class="line">        <span class="comment"># default.push 的超集，目的是在 push 到 main 分支前，提前发现问题。</span></span><br><span class="line">│   ├── mysql-trunk-stage.push <span class="comment"># 内容与 mysql-8.0-stage.push 一样，在merge到main分支前使用</span></span><br><span class="line">│   ├── mysql-trunk-stage.push.basic <span class="comment"># mysql-trunk-stage.push 的子集</span></span><br><span class="line">│   └── mysql-trunk-tsan.push <span class="comment"># 由于 ThreadSanitizer 非常慢，因此，只测试 main suite</span></span><br><span class="line"></span><br><span class="line">├── extra <span class="comment"># 不属于 main 和 其他 suites 的测试 case</span></span><br><span class="line">│   ├── binlog_tests</span><br><span class="line">│   │   ├── binlog.test</span><br><span class="line">│   │   ├── binlog_cache_stat.test</span><br><span class="line">│   │   ├── binlog_crash_safe_ddl.inc</span><br><span class="line">│   │   ├── binlog_ddl.inc</span><br><span class="line">        ......</span><br><span class="line">│   │   └── tmp_table.test</span><br><span class="line">│   └── rpl_tests</span><br><span class="line">│       ├── binlog_transaction_compression.inc</span><br><span class="line">│       ├── check_slave_delay.inc</span><br><span class="line">        ......</span><br><span class="line">│       └── type_conversions.test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">├── lib <span class="comment"># 测试框架相关依赖文件，里面主要是一些用perl实现的逻辑。</span></span><br><span class="line">│   ├── My</span><br><span class="line">│   │   ├── Config.pm</span><br><span class="line">│   │   ├── ConfigFactory.pm</span><br><span class="line">        ......</span><br><span class="line">│   │   └── Test.pm</span><br><span class="line">│   ├── mtr_cases.pm</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">├── lock_order_dependencies.txt <span class="comment"># mysql-test-run.pl 读取该文件来控制加锁顺序，与 --lock-order 选项有关。该文件非空。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 mtr 运行对应工具期间，比如 asan，对应的 .supp 文件用于指定需要跳过的测试用例。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ASAN、LSAN、TSAN 出自谷歌的 Sanitizer 项目，包含了 ASAN、LSAN、MSAN、TSAN等内存、线程错误的检测工具。</span></span><br><span class="line">├── asan.supp <span class="comment"># ASAN（Address-Sanitizier），内存错误检测工具。早期是LLVM中的特性，后被加入GCC 4.8。</span></span><br><span class="line">├── lsan.supp <span class="comment"># LSAN（LeakSanitizer），内存泄漏检测工具，已集成在 ASAN（AddressSanitizer）中。</span></span><br><span class="line">├── tsan.supp <span class="comment"># TSAN（ThreadSanitizer），线程间数据竞争的检测工具。</span></span><br><span class="line">├── valgrind.supp <span class="comment"># Valgrind 是一个工具集。集成了：</span></span><br><span class="line">                  <span class="comment"># Memcheck 内存错误检测器。</span></span><br><span class="line">                  <span class="comment"># Cachegrind 缓存和分支预测分析器。</span></span><br><span class="line">                  <span class="comment"># Callgrind 可生成缓存分析器的调用图。</span></span><br><span class="line">                  <span class="comment"># Helgrind 线程错误检测器。</span></span><br><span class="line">                  <span class="comment"># DRD 也是线程错误检测器。</span></span><br><span class="line">                  <span class="comment"># Massif 堆分析器，它可以帮助程序使用更少的内存。</span></span><br><span class="line">                  <span class="comment"># DHAT 一种不同类型的堆分析器。使用它可以了解块寿命，块利用率和布局效率低下的问题。</span></span><br><span class="line"></span><br><span class="line">├── mtr -&gt; ./mysql-test-run.pl <span class="comment"># mysql-test-run.pl 脚本别名</span></span><br><span class="line">├── mysql-stress-test.pl</span><br><span class="line">├── mysql-test-run -&gt; ./mysql-test-run.pl</span><br><span class="line">├── mysql-test-run.dox</span><br><span class="line">├── mysql-test-run.pl <span class="comment"># mtr 入口文件，测试框架核心逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># include/ 目录包含.inc 文件，在测试用例中通过 source 命令引入，就像 C/C++ 的头文件。建议将多次重复使用的测试语句整合到 .inc 文件中。</span></span><br><span class="line">├── include <span class="comment"># include 下所有 *.inc 都会被 t/ 目录下的 *.test 引用</span></span><br><span class="line">│   ├── Load_data.inc</span><br><span class="line">    ......</span><br><span class="line">│   ├── json_lookup.inc</span><br><span class="line">│   ├── keyring_tests</span><br><span class="line">│   │   ├── binlog</span><br><span class="line">│   │   │   ├── rpl_binlog_cache_encryption.inc</span><br><span class="line">        ......</span><br><span class="line">│   ├── keyring_udf_keyring_plugin_loaded.inc</span><br><span class="line">    ......</span><br><span class="line">│   └── year-engine.test</span><br><span class="line"><span class="comment"># t/ 和 r/ 目录分别对应于 main suite 的测试 case 和 期望结果。</span></span><br><span class="line"><span class="comment"># 测试 case 以 .test 后缀结尾。</span></span><br><span class="line"><span class="comment"># 另外还有 .opt 后缀文件，它里面指定了MySQL的参数。某些测试用例会涉及重启，在重启时可能会变更 mysql 参数，可能会用 .opt 文件中指定的参数。</span></span><br><span class="line">├── t <span class="comment"># 该目录下的每个 *.test 都对应一个测试 case 。</span></span><br><span class="line">│   ├── 1st.test</span><br><span class="line">│   ├── admin_interface.test</span><br><span class="line">    ......</span><br><span class="line">├── r <span class="comment"># 路径和命名 与 t/ 目录一一对应，表示对应测试用例的期望输出。</span></span><br><span class="line">│   ├── 1st.result</span><br><span class="line">│   ├── admin_interface.result</span><br><span class="line">    ......</span><br><span class="line">│   └── year-myisam.result</span><br><span class="line"></span><br><span class="line">├── std_data <span class="comment"># 测试所用的数据文件，某些测试 case 需要使用到。</span></span><br><span class="line">│   ├── 14897.frm</span><br><span class="line">│   ├── 256kb.json</span><br><span class="line">│   ├── 41_decimal.frm</span><br><span class="line">│   ├── 57import.zip</span><br><span class="line">    ......</span><br><span class="line">│   └── x_y_data.csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试框架有 suite 的概念，每个 suite 为一个测试用例集合，默认的 suite 为 main，它的测试集合位于当前目录下的 t/ 目录。</span></span><br><span class="line"><span class="comment"># 除了 main suite 之外，其他的 suite 基本都以子目录的形式存放于当前文件夹，比如 json、binlog 等。</span></span><br><span class="line">├── suite <span class="comment"># 本目录下每个子目录都包含 include/r/t 三个子目录，其中：</span></span><br><span class="line">          <span class="comment"># include/*.inc 会被 t/*.test 引用</span></span><br><span class="line">          <span class="comment"># t/*.test 是各个测试case的主文件</span></span><br><span class="line">          <span class="comment"># r/*.result 是期望的测试输出</span></span><br><span class="line">          <span class="comment"># 另外，t/ 与 r/ 路径中的文件是一一对应的。</span></span><br><span class="line">│   ├── audit_null</span><br><span class="line">    ......</span><br><span class="line">│   ├── innodb</span><br><span class="line">│   │   ├── include</span><br><span class="line">│   │   │   ├── alter_table_pk_no_sort.inc</span><br><span class="line">            ......</span><br><span class="line">│   │   ├── r</span><br><span class="line">│   │   │   ├── add_foreign_key.result</span><br><span class="line">│   │   │   ├── alter_crash.result</span><br><span class="line">            ......</span><br><span class="line">│   │   └── t</span><br><span class="line">│   │       ├── add_foreign_key.test</span><br><span class="line">│   │       ├── alter_crash.test</span><br><span class="line">            ......</span><br><span class="line">│   │       └── zlob_update_purge.test</span><br><span class="line">│   ├── innodb_fts</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">└── var <span class="comment"># 测试开启后 mtr 创建的目录，用于存放测试过程产生的数据目录、日志等。</span></span><br><span class="line">    ├── data</span><br><span class="line">    │   ├── <span class="comment">#ib_16384_0.dblwr</span></span><br><span class="line">        ......</span><br><span class="line">    ......</span><br><span class="line">    ├── my.cnf</span><br><span class="line">    ├── run</span><br><span class="line">    ├── std_data</span><br><span class="line">    │   ├── 14897.frm</span><br><span class="line">    ......</span><br><span class="line">    └── tmp</span><br><span class="line">        └── mysqld.1</span><br></pre></td></tr></table></figure>

<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQLTEST_PROGRAMS.html">MySQL: MySQL Test Programs</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_MYSQL_TEST_RUN_PL.html">MySQL: mysql-test-run.pl — Run MySQL Test Suite</a></li>
</ul>
<h2 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h2><ul>
<li><code>--force</code><ul>
<li>默认情况下，只要遇到一个 case 出错，测试程序就会退出。</li>
<li>加入该参数后，mtr 会忽略错误并继续执行下一个 case 直到所有 case 执行结束再退出。</li>
<li>但如果脚本存在太多错误还是会退出，可设置<code>--max-test-fail=0</code> 忽略计数。</li>
</ul>
</li>
<li><code>--max-test-fail</code><ul>
<li>测试过程中失败 case 数达到一定值会退出，默认值是 10，设置为 0 则会忽略计数。</li>
</ul>
</li>
<li><code>--record</code><ul>
<li><strong>是否记录 results 结果，首次执行建议带上，让其自动生成 <code>.results</code> 文件，再基于该文件修改成我们预期的结果</strong>。</li>
<li>若一个执行输出结果和 <code>testname.result</code> 文件不同，会生成一个 <code>testname.reject</code> 文件，该文件在下次执行成功之后被删除；</li>
<li>检查<code>.reject</code>文件的内容，如果里面是期望的输出，则将内容拷贝到 <code>.result</code> 文件中，作为以后判断运行结果是否通过的依据；</li>
</ul>
</li>
<li><code>--parallel</code><ul>
<li>指定运行测试 case 的并行线程数。</li>
</ul>
</li>
<li><code>—-nowarnings</code><ul>
<li>忽略 warnings 错误。</li>
<li>设置该参数后，当出现 warnings 错误，不再累加 <code>--max-test-fail</code> 。</li>
</ul>
</li>
<li><code>--big-test</code><ul>
<li>执行标记为 <code>big</code> 的 test cases，也就是同时覆盖 <strong>非 big + big</strong>。这是因为标记为 big 的 case 较大、耗时较长，默认不会执行。</li>
</ul>
</li>
<li><code>--only-big-test</code> ：只启用带 big 标记的 test cases，也就是会跳过普通的非 big 标记的 cases。</li>
<li><code>--suite=[suitename1,...]</code><ul>
<li>默认情况下 mtr 会执行所有测试 case，但有时候我们要执行一个测试集，就可用该参数来指定，比如<code>./mtr --suite=rpl</code> 只执行 rpl 测试集。</li>
</ul>
</li>
<li><code>--do-test=events</code><ul>
<li>执行所有以 <code>events</code>为前缀的 case（搜索范围为 t/和所有的 suite）。</li>
<li><code>--do-test</code> 的参数支持正则表达式，上述命令等效于 <code>./mtr --do-test=events.*</code></li>
<li>所以如果想测试所有的包括 innodb 的 case，可以用 <code>./mtr --do-test=.*innodb.*</code></li>
</ul>
</li>
<li><strong>连接远程的数据库进行 mtr 执行：</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --extern  一般情况下mtr是启动自己的MySQL服务来进行测试，如果在启动时指定参数 --extern，则可以使用指定的 MySQL 服务进行测试</span></span><br><span class="line">./mtr --extern host=192.168.6.1 --extern port=3306 --extern user=root --extern password=<span class="string">&#x27;123456&#x27;</span>  --record --force example.1</span><br><span class="line">./mtr --extern host=127.0.0.1 --extern port=3306 --extern user=root --extern password= --force --max-test-fail=0 --suite=main</span><br><span class="line">./mtr --extern host=127.0.0.1 --extern port=3306 --extern user=root --extern password= --force --max-test-fail=0 --fast --suite=main</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--debug-server</code> ：Use debug version of server, but without turning on tracing.</li>
<li><code>--platform</code> 和 <code>--exclude-platform</code> ：用于指定或排除平台的选项。<ul>
<li>如果 MTR 不是运行在 pushbuild test 环境中（存在环境变量<code>PB2WORKDIR</code>，即<code>export PB2WORKDIR=</code>），这两个选项是不生效的。</li>
</ul>
</li>
<li><code>comment=STR</code> ：添加该选项后，mtr 会将注释信息打印到 stdout 。比如 <code>--comment=all-default-big</code>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment"># all-default-big</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>--vardir=DIR</code> ：指定测试过程中生成的文件存放的目录，默认是当前路径下的<code>var/</code> 。</li>
<li><code>--report-features</code> ：指定该选项后，mtr 首先运行名为 <code>report_features</code> 的 case，该 case 没有任何输出（设置了<code>--disable_query_log</code>） 。</li>
<li><code>--unit-tests-report</code> ：加上该参数后，如果在编译后的源码目录执行 mtr，会在测试的最后阶段加上每个测试用例的报告信息。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"></span><br><span class="line">[----------] 1027 tests from Spec/ReuseConnectionTest (404 ms total)</span><br><span class="line"></span><br><span class="line">[----------] Global <span class="built_in">test</span> environment tear-down</span><br><span class="line">[==========] 1027 tests from 1 <span class="built_in">test</span> suite ran. (70804 ms total)</span><br><span class="line"></span><br><span class="line">Total Test time (real) = 3363.87 sec</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">The following tests FAILED:</span><br><span class="line">        203 - routertest_component_metadata_ttl (Subprocess aborted)</span><br><span class="line">        206 - routertest_component_rest_api_enable (Failed)</span><br><span class="line">        222 - routertest_component_routing_splicer (Failed)</span><br><span class="line">        224 - routertest_integration_routing_reuse (Failed)</span><br><span class="line">Errors <span class="keyword">while</span> running CTest</span><br><span class="line">  [  FAILED  ] CheckEdgeHttpsPortValues/UseEdgeHttpsPortValues.ensure_bootstrap_works_for_edge_https_port_values/1, <span class="built_in">where</span> GetParam() = 65535 (1444 ms)</span><br><span class="line">  [  FAILED  ] 1 <span class="built_in">test</span>, listed below:</span><br><span class="line">  [  FAILED  ] CheckEdgeHttpsPortValues/UseEdgeHttpsPortValues.ensure_bootstrap_works_for_edge_https_port_values/1, <span class="built_in">where</span> GetParam() = 65535</span><br><span class="line">   1 FAILED TEST</span><br><span class="line">  [  FAILED  ] Spec/SplicerFailParamTest.fails/client_ssl_dh_params_not_exists, <span class="built_in">where</span> GetParam() = 64-byte object &lt;C8-CE 3D-2F 4D-56 00-00 F0-DA BB-30 4D-56 00-00 B0-DB BB-30 4D-56 00-00 B0-DB BB-30 4D-56 00-00 00-00 00-00 00-00 00-00 00-00 00-00 00-00 00-00 3D-D1 F9-2E 4D-56 00-00 AD-D0 F9-2E 4D-56 00-00&gt; (383 ms)</span><br><span class="line">  [  FAILED  ] 1 <span class="built_in">test</span>, listed below:</span><br><span class="line">  [  FAILED  ] Spec/SplicerFailParamTest.fails/client_ssl_dh_params_not_exists, <span class="built_in">where</span> GetParam() = 64-byte object &lt;C8-CE 3D-2F 4D-56 00-00 F0-DA BB-30 4D-56 00-00 B0-DB BB-30 4D-56 00-00 B0-DB BB-30 4D-56 00-00 00-00 00-00 00-00 00-00 00-00 00-00 00-00 00-00 3D-D1 F9-2E 4D-56 00-00 AD-D0 F9-2E 4D-56 00-00&gt;</span><br><span class="line">   1 FAILED TEST</span><br><span class="line">  [  FAILED  ] 0 tests, listed below:</span><br><span class="line">   0 FAILED TESTS</span><br><span class="line">  [  FAILED  ] Spec/ReuseConnectionTest: SetUpTestSuite or TearDownTestSuite</span><br><span class="line">   1 FAILED TEST SUITE</span><br><span class="line"></span><br><span class="line">Unit tests: 98% tests passed, 4 tests failed out of 224</span><br><span class="line">  The following tests FAILED:</span><br><span class="line">        206 - routertest_component_rest_api_enable (Failed)</span><br><span class="line">        222 - routertest_component_routing_splicer (Failed)</span><br><span class="line">        224 - routertest_integration_routing_reuse (Failed)</span><br><span class="line">Report from unit tests <span class="keyword">in</span> /data/work/mysql/mysql-server/mysql-test/var-all-default-big/ctest.log</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">The servers were restarted 3 <span class="built_in">times</span></span><br><span class="line">The servers were reinitialized 0 <span class="built_in">times</span></span><br><span class="line">Spent 53.181 of 3579 seconds executing testcases</span><br><span class="line"></span><br><span class="line">Completed: Failed 1/6 tests, 83.33% were successful.</span><br><span class="line"></span><br><span class="line">Failing <span class="built_in">test</span>(s): unit_tests</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--no-skip</code> ：指定该选项后，即使 <code>.inc</code> 文件中要求的条件不满足，也会运行所有的 mtr 测试 cases 。特别地，在 <code>include/excludenoskip.list</code> 文件中指定的 <code>.inc</code> 文件列表依然会跳过。</li>
<li><code>--skip-ndb</code> ：与选项<code>--skip-ndbcluster</code> 含义相同，表示跳过与 ndb 相关的 suites，默认启用。<ul>
<li>ndb 引擎也是开源的（<code>storage/ndb/</code>），涉及 ndb 引擎的 suites 包括：</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- ndb</span><br><span class="line">- ndb_big</span><br><span class="line">- ndb_opt</span><br><span class="line">- ndb_ddl</span><br><span class="line">- ndb_binlog</span><br><span class="line">- ndb_rpl</span><br><span class="line">- rpl_ndb</span><br><span class="line">- ndbcluster</span><br><span class="line">- gcol_ndb</span><br><span class="line">- json_ndb</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--with-ndb-only</code> ：与选项<code>--with-ndbcluster-only</code> 含义相同，只运行与 ndb 相关的 suites 。如果没显示指定<code>--suites</code> 参数，则会跳过所有非 ndb 的 suites ；反之，若指定了，也会额外运行指定的 suites 。</li>
<li><code>--ps-protocol</code> ：在 client 和 server 端之间使用 prepared-statement 协议（binary），会将<code>--ps-protocol</code> 参数直接传给 mysqltest 程序。</li>
<li><code>--skip-combinations</code> ：忽略组合文件或选项，也就是忽略：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 mtr 时的日志：</span></span><br><span class="line">Collecting tests</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> binlog</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> binlog_gtid</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> binlog_nogtid</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> rpl</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> rpl_gtid</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> rpl_nogtid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对应于</span></span><br><span class="line">./suite/rpl_nogtid/combinations</span><br><span class="line">./suite/binlog_gtid/combinations</span><br><span class="line">./suite/binlog/combinations</span><br><span class="line">./suite/rpl/combinations</span><br><span class="line">./suite/rpl_gtid/combinations</span><br><span class="line">./suite/binlog_nogtid/combinations</span><br><span class="line"></span><br><span class="line"><span class="comment"># 除此之外，还有：</span></span><br><span class="line">./suite/ndb_rpl/t/ndb_rpl_innodb2ndb.combinations</span><br><span class="line">./suite/ndb_rpl/t/ndb_rpl_conflict_epoch.combinations</span><br><span class="line">./suite/ndb_rpl/t/ndb_rpl_basic.combinations</span><br></pre></td></tr></table></figure>

<h2 id="suitename-可选范围"><a href="#suitename-可选范围" class="headerlink" title="suitename 可选范围"></a>suitename 可选范围</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">main,</span><br><span class="line"></span><br><span class="line">audit_null,</span><br><span class="line">auth_sec,</span><br><span class="line"></span><br><span class="line">binlog,</span><br><span class="line">binlog_gtid,</span><br><span class="line">binlog_nogtid,</span><br><span class="line"><span class="built_in">clone</span>,</span><br><span class="line"></span><br><span class="line">collations,</span><br><span class="line"></span><br><span class="line">component_keyring_file,</span><br><span class="line">connection_control,</span><br><span class="line">encryption,</span><br><span class="line"></span><br><span class="line">engines,</span><br><span class="line">engines/funcs,</span><br><span class="line">engines/iuds,</span><br><span class="line">engines/rr_trx,</span><br><span class="line">federated,</span><br><span class="line"></span><br><span class="line">funcs_1, <span class="comment"># 额外功能（包括视图、存储过程、INFORMATION_SCHEMA等）</span></span><br><span class="line">funcs_2, <span class="comment"># 额外功能（字符集等）</span></span><br><span class="line">gcol, <span class="comment"># 虚拟生成列</span></span><br><span class="line">gis,</span><br><span class="line">group_replication,</span><br><span class="line">information_schema,</span><br><span class="line"></span><br><span class="line">innodb,</span><br><span class="line">innodb_fts, <span class="comment"># 全文索引</span></span><br><span class="line">innodb_gis,</span><br><span class="line">innodb_stress,</span><br><span class="line">innodb_undo,</span><br><span class="line">innodb_zip,</span><br><span class="line"></span><br><span class="line">interactive_utilities,</span><br><span class="line">jp, <span class="comment"># 日语字符集</span></span><br><span class="line">json,</span><br><span class="line">large_tests,</span><br><span class="line">lock_order,</span><br><span class="line">max_parts,</span><br><span class="line">memcached,</span><br><span class="line">network_namespace,</span><br><span class="line">opt_trace,</span><br><span class="line">parts,parts/special_tests,</span><br><span class="line">perfschema,</span><br><span class="line">query_rewrite_plugins,</span><br><span class="line"></span><br><span class="line">rpl,</span><br><span class="line">rpl_gtid,</span><br><span class="line">rpl_nogtid,</span><br><span class="line"></span><br><span class="line">secondary_engine,</span><br><span class="line"></span><br><span class="line">service_status_var_registration,</span><br><span class="line">service_sys_var_registration,</span><br><span class="line">service_udf_registration,</span><br><span class="line"></span><br><span class="line">special,</span><br><span class="line">stress,</span><br><span class="line">sys_vars,</span><br><span class="line">sysschema,</span><br><span class="line"></span><br><span class="line">test_service_sql_api,</span><br><span class="line">test_services,</span><br><span class="line"></span><br><span class="line">x</span><br></pre></td></tr></table></figure>

<h1 id="suites-分类"><a href="#suites-分类" class="headerlink" title="suites 分类"></a>suites 分类</h1><h2 id="default-suites"><a href="#default-suites" class="headerlink" title="default suites:"></a>default suites:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">auth_sec,binlog,binlog_gtid,binlog_nogtid,<span class="built_in">clone</span>,</span><br><span class="line">collations,component_keyring_file,connection_control,encryption,</span><br><span class="line">federated,funcs_2,gcol,gis,information_schema,</span><br><span class="line">innodb,innodb_fts,innodb_gis,innodb_undo,innodb_zip,</span><br><span class="line">interactive_utilities,json,</span><br><span class="line">main,</span><br><span class="line">opt_trace,parts,perfschema,query_rewrite_plugins,rpl,rpl_gtid,rpl_nogtid,secondary_engine,</span><br><span class="line">service_status_var_registration,service_sys_var_registration,service_udf_registration,</span><br><span class="line">sys_vars,sysschema,test_service_sql_api,test_services,x</span><br></pre></td></tr></table></figure>

<h2 id="非-default-suites："><a href="#非-default-suites：" class="headerlink" title="非 default suites："></a>非 default suites：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">funcs_2, stress, jp, nist</span><br><span class="line">engines, memcached, audit_null</span><br><span class="line">group_replication</span><br></pre></td></tr></table></figure>

<h1 id="指令示例"><a href="#指令示例" class="headerlink" title="指令示例"></a>指令示例</h1><h2 id="mtr-执行路径："><a href="#mtr-执行路径：" class="headerlink" title="mtr 执行路径："></a><strong>mtr 执行路径：</strong></h2><ul>
<li>代码覆盖率、单元测试只能在 <code>编译的源码目录/mysql-test</code> 执行。</li>
<li>其他测试在 <code>编译的源码目录/mysql-test</code> 和 <code>安装目录/mysql-test</code> 都可以执行。</li>
<li><strong>如无特殊需求，更建议在安装目录执行 mtr 测试</strong>（目录结构更清晰）。</li>
</ul>
<h2 id="常用指令："><a href="#常用指令：" class="headerlink" title="常用指令："></a>常用指令：</h2><ul>
<li>在未编写 <code>.result</code>文件的情况下，可先通过<code>--reocrd</code>选项生成<code>.result</code>文件，再基于该文件修改成期望的结果：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl mysql-test-run.pl --record mytest</span><br></pre></td></tr></table></figure>

<ul>
<li>常态下执行，不加 <code>--reocrd</code>选项，这样才会比对实际结果与期望结果是否相同：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perl mysql-test-run.pl mytestcase1</span><br><span class="line">perl mysql-test-run.pl --suites=main,rpl <span class="comment"># 指定多个 suites</span></span><br></pre></td></tr></table></figure>

<ul>
<li>当一些测试 case 频繁失败时，可单独运行这些 case 以便调试：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./mtr testcasename --record</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只运行基础套餐里的 subquery_all 用例（ t/subquery_all.test ）</span></span><br><span class="line"><span class="comment"># 可选 --charset-for-testdb=utf8mb4</span></span><br><span class="line">./mtr --force --big-test --nowarnings --max-test-fail=0 main.subquery_all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如需执行多个 case，可通过空格分割，比如：</span></span><br><span class="line">./mtr --force --big-test --nowarnings --max-test-fail=0 main.subquery_all main.myisam_explain_json_non_select_none</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>如果不指定任何 suite，mtr 默认会执行所有 default suites（包括 main）</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./mtr --force</span><br></pre></td></tr></table></figure>

<ul>
<li>执行 main suite 中的所有 case（所有<code>mysql-test/t/*.test</code>），忽略中间的 warnings 报错，强制运行完所有 case：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./mtr  --suite=main --force --max-test-fail=0 --nowarnings --parallel=8</span><br><span class="line">./mtr  --suite=main --force --max-test-fail=0 --nowarnings --parallel=8 --big-test</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>执行所有以 <code>events </code>为前缀的 case，搜索范围为 <code>mysql-test/t</code>、<code>mysql-test/suite</code>，注意不包括<code>extra/</code> ：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --do-test 参数支持正则表达式，该指令等效于./mtr --do-test=events.*</span></span><br><span class="line">./mtr --do-test=events --force --max-test-fail=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果想测试所有包含 innodb 的 case，可以用 ./mtr --do-test=.*innodb.*</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="特殊用法："><a href="#特殊用法：" class="headerlink" title="特殊用法："></a>特殊用法：</h2><ul>
<li><p>1、准备数据库： <code>create database test</code> 。</p>
<ul>
<li><p>a）执行 <code>./mtr --extern host=127.0.0.1 --extern port=3306 --extern user=root --extern password= --force --max-test-fail=0 --suite=main</code> ，第一个非 skipped case 可以执行成功，但之后的 case 全部失败。</p>
</li>
<li><p>b）分析原因，发现是每执行完一个 case ，mtr 就会 shutdown mysqld server，下一个 case 再启动，而这里是使用的外部 mysql，则不会启动。</p>
</li>
</ul>
</li>
<li><p>2、查看手册，发现有一个参数可以控制是否每个 case 都重启 mysqld：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--fast</span><br><span class="line"></span><br><span class="line">Do not perform controlled shutdown when servers need to be restarted or at the end of the <span class="built_in">test</span> run. This is equivalent to using --shutdown-timeout=0.</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>3、添加后，虽然不重启了，但会导致一些 case 失败。 这是因为有些 case 需要初始化一些参数</strong>：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Note</span><br><span class="line"></span><br><span class="line">    If a <span class="built_in">test</span> <span class="keyword">case</span> has an .opt file that requires the server to be restarted with specific options, the</span><br><span class="line">    file will not be used. The <span class="built_in">test</span> <span class="keyword">case</span> likely will fail as a result.</span><br></pre></td></tr></table></figure>

<p>可见，<strong>官方对这种用法的支持尚不完善</strong>。</p>
<h1 id="推荐用法"><a href="#推荐用法" class="headerlink" title="推荐用法"></a>推荐用法</h1><p>如果需要验证 release 版本稳定性（适用于 QA、研发），可参考 <code>default.daily</code> 中的指令集。</p>
<ul>
<li>该指令集覆盖了单元测试（必须以 DEBUG 编译）、压力测试等。</li>
</ul>
<h1 id="如何添加测试用例？"><a href="#如何添加测试用例？" class="headerlink" title="如何添加测试用例？"></a>如何添加测试用例？</h1><h2 id="1-示例一"><a href="#1-示例一" class="headerlink" title="1. 示例一"></a>1. 示例一</h2><p>我们通过一个最简单的例子来说明这个框架是怎么使用的。</p>
<h3 id="1-1-创建测试用例"><a href="#1-1-创建测试用例" class="headerlink" title="1.1. 创建测试用例"></a>1.1. 创建测试用例</h3><p>在 <code>mysql-test/t</code> 目录下创建一个文件名为 <code>mytest.test</code> 的测试用例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--disable_warnings</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> t1;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@sql</span>_mode<span class="operator">=</span><span class="string">&#x27;NO_ENGINE_SUBSTITUTION&#x27;</span>;</span><br><span class="line"><span class="comment">--enable_warnings</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> SQL_WARNINGS<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--echo #</span></span><br><span class="line"><span class="comment">--echo # test content</span></span><br><span class="line"><span class="comment">--echo #</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (a <span class="type">INT</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> t1;</span><br></pre></td></tr></table></figure>

<p>在<code>mysql-test/r</code> 目录下创建名为<code>mytest.result</code> 的文件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> t1;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@sql</span>_mode<span class="operator">=</span><span class="string">&#x27;NO_ENGINE_SUBSTITUTION&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> SQL_WARNINGS<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">#</span><br><span class="line"># test content</span><br><span class="line">#</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (a <span class="type">INT</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1;</span><br><span class="line">a</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> t1;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可见，<code>.result</code> 文件中不仅要记录 SQL，还要记录输出结果。</p>
<h3 id="1-2-执行测试，成功"><a href="#1-2-执行测试，成功" class="headerlink" title="1.2. 执行测试，成功"></a>1.2. 执行测试，成功</h3><p>指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> mysql80-debug/mysql-test</span><br><span class="line">./mtr main.mytest</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Logging: ./mtr  main.mytest</span><br><span class="line">MySQL Version 8.0.29</span><br><span class="line">Checking supported features</span><br><span class="line"> - Binaries are debug compiled</span><br><span class="line">Using <span class="string">&#x27;all&#x27;</span> suites</span><br><span class="line">Collecting tests</span><br><span class="line">Checking leftover processes</span><br><span class="line">Removing old var directory</span><br><span class="line">Creating var directory <span class="string">&#x27;/Users/wslu/work/mysql/mysql80-debug/mysql-test/var&#x27;</span></span><br><span class="line">Installing system database</span><br><span class="line">Using parallel: 1</span><br><span class="line"></span><br><span class="line">==============================================================================</span><br><span class="line">                  TEST NAME                       RESULT  TIME (ms) COMMENT</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">[ 50%] main.mytest                               [ pass ]     63</span><br><span class="line">[100%] shutdown_report                           [ pass ]</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">The servers were restarted 0 <span class="built_in">times</span></span><br><span class="line">The servers were reinitialized 0 <span class="built_in">times</span></span><br><span class="line">Spent 0.063 of 16 seconds executing testcases</span><br><span class="line"></span><br><span class="line">Completed: All 2 tests were successful.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看到 successful 说明执行成功。</p>
<h3 id="1-3-修改-result-文件"><a href="#1-3-修改-result-文件" class="headerlink" title="1.3. 修改 result 文件"></a>1.3. 修改 result 文件</h3><p>在 <code>mytest.result</code> 文件中添加一些字符：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS t1;</span><br><span class="line">SET @@sql_mode=<span class="string">&#x27;NO_ENGINE_SUBSTITUTION&#x27;</span>;</span><br><span class="line">SET SQL_WARNINGS=1;</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># test content</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">CREATE TABLE t1 (a INT);</span><br><span class="line">INSERT INTO t1 VALUES (1);</span><br><span class="line">INSERT INTO t1 VALUES (2);</span><br><span class="line">SELECT * FROM t1; <span class="comment"># new comment</span></span><br><span class="line">a</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">DROP TABLE t1;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-再次执行测试，失败"><a href="#1-4-再次执行测试，失败" class="headerlink" title="1.4. 再次执行测试，失败"></a>1.4. 再次执行测试，失败</h3><p>再次执行指令<code>./mtr main.mytest</code> ，可见<code># new comment</code> 那一行报错：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">                  TEST NAME                       <span class="keyword">RESULT</span>  <span class="type">TIME</span> (ms) COMMENT</span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line">[ <span class="number">50</span><span class="operator">%</span>] main.mytest                               [ fail ]</span><br><span class="line">        Test ended <span class="keyword">at</span> <span class="number">2023</span><span class="number">-03</span><span class="number">-20</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">50</span></span><br><span class="line"></span><br><span class="line">CURRENT_TEST: main.mytest</span><br><span class="line"><span class="comment">--- /Users/wslu/work/mysql/mysql80-debug.bak_asan_ubsan_gcov/mysql-test/r/mytest.result  2023-03-20 10:07:31.000000000 +0300</span></span><br><span class="line"><span class="operator">+</span><span class="operator">+</span><span class="operator">+</span> <span class="operator">/</span>Users<span class="operator">/</span>wslu<span class="operator">/</span>work<span class="operator">/</span>mysql<span class="operator">/</span>mysql80<span class="operator">-</span>debug.bak_asan_ubsan_gcov<span class="operator">/</span>mysql<span class="operator">-</span>test<span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mytest.reject  <span class="number">2023</span><span class="number">-03</span><span class="number">-20</span> <span class="number">10</span>:<span class="number">07</span>:<span class="number">50.000000000</span> <span class="operator">+</span><span class="number">0300</span></span><br><span class="line">@@ <span class="number">-7</span>,<span class="number">7</span> <span class="operator">+</span><span class="number">7</span>,<span class="number">7</span> @@</span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (a <span class="type">INT</span>);</span><br><span class="line"> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">2</span>);</span><br><span class="line"><span class="operator">-</span><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1; # <span class="keyword">new</span> comment</span><br><span class="line"><span class="operator">+</span><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1;</span><br><span class="line"> a</span><br><span class="line"> <span class="number">1</span></span><br><span class="line"> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">mysqltest: <span class="keyword">Result</span> length mismatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The <span class="keyword">result</span> <span class="keyword">from</span> queries just before the failure was:</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> t1;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@sql</span>_mode<span class="operator">=</span><span class="string">&#x27;NO_ENGINE_SUBSTITUTION&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> SQL_WARNINGS<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">#</span><br><span class="line"># test content</span><br><span class="line">#</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (a <span class="type">INT</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span> (<span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1;</span><br><span class="line">a</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> t1;</span><br><span class="line">safe_process[<span class="number">19130</span>]: Child process: <span class="number">19131</span>, exit: <span class="number">1</span></span><br><span class="line"></span><br><span class="line"> <span class="operator">-</span> the logfile can be found <span class="keyword">in</span> <span class="string">&#x27;/Users/wslu/work/mysql/mysql80-debug.bak_asan_ubsan_gcov/mysql-test/var/log/main.mytest/mytest.log&#x27;</span></span><br><span class="line"></span><br><span class="line">[<span class="number">100</span><span class="operator">%</span>] shutdown_report                           [ pass ]</span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>

<p>mtr 会指出具体是哪行导致的 case 失败。</p>
<h1 id="常见问题-FAQ"><a href="#常见问题-FAQ" class="headerlink" title="常见问题 FAQ"></a>常见问题 FAQ</h1><h2 id="test-case-failed-原因"><a href="#test-case-failed-原因" class="headerlink" title="test case failed 原因"></a>test case failed 原因</h2><ol>
<li>产生的测试结果文件与预期输出文件 diff 结果不一致：<ol>
<li>期望输入的 SQL 执行成功，实际执行失败。</li>
<li>期望输入的 SQL 执行失败，实际执行成功。</li>
<li>比如：<code>mysql-test/t/select_all.test</code> 这个测试 case，其预期结果在<code>mysql-test/r/select_all.result</code>，在实际执行时，会将执行结果与<code>mysql-test/r/select_all.result</code>作比较，若不一致，则失败，并在<code>mysql-test/var/log</code>目录生成一个<code>.reject</code>文件。</li>
</ol>
</li>
<li>测试过程中 mysql server 挂掉。这种情况一般会报“丢失连接”的错误。</li>
<li>测试期间 MySQL Server 端写入了未过滤的 warnings 或 errors 日志。</li>
</ol>
<blockquote>
<p>此外，测试用例可以执行外部程序，因此在某些方面，测试框架可以扩展为测试 SQL 语句以外的用途。<br>最后，可以在测试中嵌入一小段 Perl 代码。这有时可用于执行超出测试语言或 SQL 能力的操作或执行逻辑。</p>
</blockquote>
<p>可使用一些技巧来定为具体的错误原因，详见下节。</p>
<h1 id="异常调试"><a href="#异常调试" class="headerlink" title="异常调试"></a>异常调试</h1><h2 id="分析日志"><a href="#分析日志" class="headerlink" title="分析日志"></a>分析日志</h2><p>默认情况下，在目录 <code>mysql-test/var/log/</code>中有日志生成（若指定 <code>--vardir</code> 参数，则以该参数路径为准），分析该日志也能得到一些有用信息。</p>
<p>比如 启动失败，则可以查看 <code>bootstrap.log</code> 文件，去掉命令中的 <code>--bootstrap</code> 并运行即可启动对应的 MySQL 服务来验证、调试。</p>
<h2 id="verbose-参数"><a href="#verbose-参数" class="headerlink" title="verbose 参数"></a>verbose 参数</h2><p>启动 mtr 时加 <code>--verbose</code> 参数，定位到引用的脚本位置后可以配置 <code>--echo</code> 命令修改调试。</p>
<p>如果加上 <code>--verbose</code> 打印的内容还不够详细，可以再加一个，即 <code>--verbose --verbose</code>，能打印出 mtr perl 脚本中的日志信息。</p>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">wslu@ubuntu:/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test$ perl mysql-test-run.pl --timer  --force --parallel=1 --vardir=var-rpl --suite=rpl --verbose</span><br><span class="line">Logging: mysql-test-run.pl  --timer --force --parallel=1 --vardir=var-rpl --suite=rpl --verbose</span><br><span class="line">&gt; exe_name: mysqld</span><br><span class="line">MySQL Version 8.0.29</span><br><span class="line">Checking supported features</span><br><span class="line"> - Binaries are debug compiled</span><br><span class="line">&gt; Testing FIPS: --test-ssl-fips-mode 0 error:0F06D065:common libcrypto routines:FIPS_mode_set:fips mode not supported</span><br><span class="line"></span><br><span class="line">Using suite(s): rpl</span><br><span class="line">Collecting tests</span><br><span class="line">&gt; Collecting: rpl</span><br><span class="line">&gt; suitedir: /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/suite/rpl</span><br><span class="line">&gt; testdir: /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/suite/rpl/t</span><br><span class="line">&gt; resdir: /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/suite/rpl/r</span><br><span class="line">&gt; Read combinations file /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/suite/rpl/combinations.</span><br><span class="line"> - Adding combinations <span class="keyword">for</span> rpl</span><br><span class="line">&gt; Collecting: i_rpl</span><br><span class="line">Removing old var directory</span><br><span class="line">&gt; opt_vardir: /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl</span><br><span class="line">&gt; Removing /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var</span><br><span class="line">&gt; Removing /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/</span><br><span class="line">&gt; Removing /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/</span><br><span class="line">Creating var directory <span class="string">&#x27;/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl&#x27;</span></span><br><span class="line">&gt; Creating /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl</span><br><span class="line">Installing system database</span><br><span class="line"><span class="comment">### safe_path: /data/work/mysql/mysql80-install.bak_asan_ubsan/bin//mysqltest_safe_process --verbose -- /data/work/mysql/mysql80-install.bak_asan_ubsan/bin/mysqld --no-defaults --initialize-insecure --loose-skip-ndbcluster --tmpdir=/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/ --core-file --datadir=/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/data/ --secure-file-priv=/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl --innodb_buffer_pool_size=24M --innodb-log-file-size=5M --innodb_autoextend_increment=8 --character-sets-dir=/data/work/mysql/mysql80-install.bak_asan_ubsan/share/charsets --loose-auto_generate_certs=OFF --loose-sha256_password_auto_generate_rsa_keys=OFF --loose-caching_sha2_password_auto_generate_rsa_keys=OFF --init-file=/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/bootstrap.sql</span></span><br><span class="line">Using parallel: 1</span><br><span class="line"></span><br><span class="line">==============================================================================</span><br><span class="line">                  TEST NAME                       RESULT  TIME (ms) COMMENT</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">&gt; Client connected</span><br><span class="line">worker[1] &gt; mtr_ping_port: 13000</span><br><span class="line">worker[1] &gt; FREE</span><br><span class="line">worker[1] &gt; mtr_ping_port: 13001</span><br><span class="line">worker[1] &gt; FREE</span><br><span class="line">worker[1] &gt; mtr_ping_port: 13002</span><br><span class="line">worker[1] &gt; FREE</span><br><span class="line">worker[1] &gt; mtr_ping_port: 13003</span><br><span class="line">worker[1] &gt; FREE</span><br><span class="line">......</span><br><span class="line">worker[1] &gt; mtr_ping_port: 13029</span><br><span class="line">worker[1] &gt; FREE</span><br><span class="line">worker[1] &gt; Using MTR_BUILD_THREAD 300, with reserved ports 13000..13029</span><br><span class="line">worker[1] Creating var directory <span class="string">&#x27;/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl&#x27;</span></span><br><span class="line">worker[1] &gt; result: , file_mode: 0</span><br><span class="line">[  0%] rpl.rpl_atomic_ddl                        [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_atomic_ddl_no_binlog              [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_binlog_cache_encryption           [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_filters_error_cases_on_startup    [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_group_commit_deadlock             [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_group_commit_deadlock_myisam      [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_innodb_auto_increment             [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_killed_ddl                        [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_log_info_repository_persistence_assign_gtids_to_anonymous_transactions  [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_log_info_repository_persistence_require_row  [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_log_info_repository_persistence_require_table_primary_key_check  [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_row_crash_safe                    [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_row_mts_rec_crash_safe            [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_stm_mixed_crash_safe              [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_stm_mixed_mts_rec_crash_safe      [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_stm_mixed_mts_rec_crash_safe_checksum  [ skipped ]  Test needs <span class="string">&#x27;big-test&#x27;</span> or <span class="string">&#x27;only-big-test&#x27;</span> option.</span><br><span class="line">[  0%] rpl.rpl_io_thd_wait_for_disk_space_stress  [ disabled ]   BUG<span class="comment">#23581287 Disabled until bug is fixed.</span></span><br><span class="line">[  0%] rpl.rpl_writeset_add_unique_key           [ disabled ]   Bug<span class="comment">#33134835 RPL_WRITESET_ADD_UNIQUE_KEY FAILS SPORADICALLY</span></span><br><span class="line">worker[1] &gt; Running <span class="built_in">test</span>: rpl.rpl_plugin_load</span><br><span class="line">worker[1] &gt; Setting timezone: GMT-3</span><br><span class="line">worker[1] &gt; Cleaning datadirs...</span><br><span class="line">worker[1] &gt; clean_dir: /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp</span><br><span class="line">worker[1] &gt; unlink: <span class="string">&#x27;/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/bootstrap.sql&#x27;</span></span><br><span class="line">worker[1] &gt; Generating my.cnf from <span class="string">&#x27;/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/suite/rpl/my.cnf&#x27;</span></span><br><span class="line">worker[1] &gt; MASTER_MYPORT = 13000</span><br><span class="line">worker[1] &gt; MASTER_MYSOCK = /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/mysqld.1.sock</span><br><span class="line">worker[1] &gt; MASTER_X_MYSOCK = /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/mysqlx.1.sock</span><br><span class="line">worker[1] &gt; SLAVE_MYPORT = 13002</span><br><span class="line">worker[1] &gt; SLAVE_MYSOCK = /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/mysqld.2.sock</span><br><span class="line">worker[1] &gt; SLAVE_X_MYSOCK = /data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/tmp/mysqlx.2.sock</span><br><span class="line">worker[1] &gt; mysqld_start:  [<span class="string">&#x27; --plugin-dir=/data/work/mysql/mysql80-install.bak_asan_ubsan/lib/plugin&#x27;</span>, <span class="string">&#x27;--binlog-format=mixed &#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">### safe_path: /data/work/mysql/mysql80-install.bak_asan_ubsan/bin//mysqltest_safe_process --verbose -- /data/work/mysql/mysql80-install.bak_asan_ubsan/bin/mysqld --defaults-group-suffix=.1 --defaults-file=/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test/var-rpl/my.cnf --log-output=file --loose-debug-sync-timeout=600 --plugin-dir=/data/work/mysql/mysql80-install.bak_asan_ubsan/lib/plugin --binlog-format=mixed --core-file</span></span><br><span class="line">worker[1] &gt; Started [mysqld.1 - pid: 61921, winpid: 61921]</span><br><span class="line">worker[1] &gt; mysqld_start:  [<span class="string">&#x27; --plugin-dir=/data/work/mysql/mysql80-install.bak_asan_ubsan/lib/plugin&#x27;</span>, <span class="string">&#x27;--binlog-format=mixed &#x27;</span>]</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="debug-参数和-gdb-参数"><a href="#debug-参数和-gdb-参数" class="headerlink" title="debug 参数和 gdb 参数"></a>debug 参数和 gdb 参数</h2><p>mtr 支持的一些 debug 参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">debug                 Dump trace output <span class="keyword">for</span> all servers and client programs.</span><br><span class="line">debug-common          Same as debug, but sets <span class="string">&#x27;d&#x27;</span> debug flags to</span><br><span class="line">                      <span class="string">&quot;query,info,error,enter,exit&quot;</span>; you need this <span class="keyword">if</span> you</span><br><span class="line">                      want both to see debug printouts and to use</span><br><span class="line">                      DBUG_EXECUTE_IF.</span><br><span class="line">debug-server          Use debug version of server, but without turning on</span><br><span class="line">                      tracing.</span><br><span class="line">debugger=NAME         Start mysqld <span class="keyword">in</span> the selected debugger.</span><br><span class="line">gdb                   Start the mysqld(s) <span class="keyword">in</span> gdb.</span><br><span class="line">lldb                  Start the mysqld(s) <span class="keyword">in</span> lldb.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可见，要想跟踪调用过程，只有 <code>--debug</code> 和 <code>--gdb</code> 参数满足要求，会生成 trace 信息。</p>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这几条指令很耗费内存</span></span><br><span class="line">./mtr --debug --suite=rpl</span><br><span class="line">./mtr --gdb --suite=rpl</span><br><span class="line">./mtr --debug --gdb --suite=rpl</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>指令执行后，生成 trace 文件，比如 <code>var/log/bootstrap.trace</code> 。</p>
<h2 id="脚本自身支持-debug-参数"><a href="#脚本自身支持-debug-参数" class="headerlink" title="脚本自身支持 debug 参数"></a>脚本自身支持 debug 参数</h2><p>如果引用（<code>source</code>）的脚本支持 debug 参数，比如常用的 <code>$rpl_debug</code>，则可以修改相应的 <code>.inc</code> 文件以获得更多的 debug 信息。</p>
<h2 id="perl-的调试模式"><a href="#perl-的调试模式" class="headerlink" title="perl 的调试模式"></a>perl 的调试模式</h2><p>添加<code>-d</code> 参数可进入 perl 语言的 debug 模式，便于调试 <code>mysql-test-run.pl</code> 及其调用。示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">wslu@ubuntu:/data/work/mysql/mysql80-install.bak_asan_ubsan/mysql-test$ perl -d mysql-test-run.pl --timer  --force --parallel=1 --vardir=var-rpl --suite=rpl</span><br><span class="line"></span><br><span class="line">Loading DB routines from perl5db.pl version 1.60</span><br><span class="line">Editor support available.</span><br><span class="line"></span><br><span class="line">Enter h or <span class="string">&#x27;h h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>, or <span class="string">&#x27;man perldebug&#x27;</span> <span class="keyword">for</span> more <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line">main::(mysql-test-run.pl:54):  push @INC, <span class="string">&quot;.&quot;</span>;</span><br><span class="line">  DB&lt;1&gt; l</span><br><span class="line">54==&gt;  push @INC, <span class="string">&quot;.&quot;</span>;</span><br><span class="line">55</span><br><span class="line">56:  use My::ConfigFactory;</span><br><span class="line">57:  use My::CoreDump;</span><br><span class="line">58:  use My::File::Path;    <span class="comment"># Patched version of File::Path</span></span><br><span class="line">59:  use My::Find;</span><br><span class="line">60:  use My::Options;</span><br><span class="line">61:  use My::Platform;</span><br><span class="line">62:  use My::SafeProcess;</span><br><span class="line">63:  use My::SysInfo;</span><br><span class="line">  DB&lt;1&gt; n</span><br><span class="line">main::(mysql-test-run.pl:72):  require <span class="string">&quot;lib/mtr_gcov.pl&quot;</span>;</span><br><span class="line">  DB&lt;1&gt; l</span><br><span class="line">72==&gt;  require <span class="string">&quot;lib/mtr_gcov.pl&quot;</span>;</span><br><span class="line">73:  require <span class="string">&quot;lib/mtr_gprof.pl&quot;</span>;</span><br><span class="line">74:  require <span class="string">&quot;lib/mtr_io.pl&quot;</span>;</span><br><span class="line">75:  require <span class="string">&quot;lib/mtr_lock_order.pl&quot;</span>;</span><br><span class="line">76:  require <span class="string">&quot;lib/mtr_misc.pl&quot;</span>;</span><br><span class="line">77:  require <span class="string">&quot;lib/mtr_process.pl&quot;</span>;</span><br><span class="line">78</span><br><span class="line">79:  our <span class="variable">$secondary_engine_support</span> = <span class="built_in">eval</span> <span class="string">&#x27;use mtr_secondary_engine; 1&#x27;</span>;</span><br><span class="line">80</span><br><span class="line">81   <span class="comment"># Global variable to keep track of completed test cases</span></span><br><span class="line">  DB&lt;1&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调试模式常用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">h       查看帮助文档</span><br><span class="line">c line  运行到指定行</span><br><span class="line">n       运行到下一行</span><br><span class="line">s       跳到函数内部运行</span><br><span class="line">l       查看代码</span><br><span class="line">q       退出</span><br></pre></td></tr></table></figure>

<hr>
<p>欢迎关注我的微信公众号【数据库内核】：分享主流开源数据库和存储引擎相关技术。</p>
<img src="https://dbkernel-1306518848.cos.ap-beijing.myqcloud.com/wechat/my-wechat-official-account.png" width="400" height="400" alt="欢迎关注公众号数据库内核" align="center"/>

<table>
<thead>
<tr>
<th>标题</th>
<th>网址</th>
</tr>
</thead>
<tbody><tr>
<td>GitHub</td>
<td><a href="https://dbkernel.github.io/">https://dbkernel.github.io</a></td>
</tr>
<tr>
<td>知乎</td>
<td><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/dbkernel/posts">https://www.zhihu.com/people/dbkernel/posts</a></td>
</tr>
<tr>
<td>思否（SegmentFault）</td>
<td><a target="_blank" rel="noopener" href="https://segmentfault.com/u/dbkernel">https://segmentfault.com/u/dbkernel</a></td>
</tr>
<tr>
<td>掘金</td>
<td><a target="_blank" rel="noopener" href="https://juejin.im/user/5e9d3ed251882538083fed1f/posts">https://juejin.im/user/5e9d3ed251882538083fed1f/posts</a></td>
</tr>
<tr>
<td>CSDN</td>
<td><a target="_blank" rel="noopener" href="https://blog.csdn.net/dbkernel">https://blog.csdn.net/dbkernel</a></td>
</tr>
<tr>
<td>博客园（cnblogs）</td>
<td><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dbkernel">https://www.cnblogs.com/dbkernel</a></td>
</tr>
</tbody></table>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2023/03/18/mysql-mtr-01-introduction/">特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">DBKernel</a></p>
        <p><span>发布时间:</span>2023-03-18, 21:58:52</p>
        <p><span>最后更新:</span>2023-04-17, 23:29:31</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2023/03/18/mysql-mtr-01-introduction/" title="特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇">http://dbkernel.github.io/2023/03/18/mysql-mtr-01-introduction/</a>
            <span class="copy-path" data-clipboard-text="原文: http://dbkernel.github.io/2023/03/18/mysql-mtr-01-introduction/　　作者: DBKernel" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2023/05/01/mysql-mtr-02-advanced/">
                    特性介绍 | MySQL 测试框架 MTR 系列教程（二）：进阶篇 - 内存/线程/代码覆盖率/单元/压力测试
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2022/07/06/StoneDB-an-integrated-real-time-HTAP-database/">
                    推荐 | 一体化实时 HTAP 数据库 StoneDB，如何替换 MySQL 并实现近百倍性能提升
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mtr-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">mtr 工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">框架流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">编译安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">3.1.</span> <span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">3.2.</span> <span class="toc-text">编译</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">常用参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#suitename-%E5%8F%AF%E9%80%89%E8%8C%83%E5%9B%B4"><span class="toc-number">5.2.</span> <span class="toc-text">suitename 可选范围</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#suites-%E5%88%86%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">suites 分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#default-suites"><span class="toc-number">6.1.</span> <span class="toc-text">default suites:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E-default-suites%EF%BC%9A"><span class="toc-number">6.2.</span> <span class="toc-text">非 default suites：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">指令示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mtr-%E6%89%A7%E8%A1%8C%E8%B7%AF%E5%BE%84%EF%BC%9A"><span class="toc-number">7.1.</span> <span class="toc-text">mtr 执行路径：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%EF%BC%9A"><span class="toc-number">7.2.</span> <span class="toc-text">常用指令：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%94%A8%E6%B3%95%EF%BC%9A"><span class="toc-number">7.3.</span> <span class="toc-text">特殊用法：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E7%94%A8%E6%B3%95"><span class="toc-number">8.</span> <span class="toc-text">推荐用法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%EF%BC%9F"><span class="toc-number">9.</span> <span class="toc-text">如何添加测试用例？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%A4%BA%E4%BE%8B%E4%B8%80"><span class="toc-number">9.1.</span> <span class="toc-text">1. 示例一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B"><span class="toc-number">9.1.1.</span> <span class="toc-text">1.1. 创建测试用例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E6%88%90%E5%8A%9F"><span class="toc-number">9.1.2.</span> <span class="toc-text">1.2. 执行测试，成功</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E4%BF%AE%E6%94%B9-result-%E6%96%87%E4%BB%B6"><span class="toc-number">9.1.3.</span> <span class="toc-text">1.3. 修改 result 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%86%8D%E6%AC%A1%E6%89%A7%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E5%A4%B1%E8%B4%A5"><span class="toc-number">9.1.4.</span> <span class="toc-text">1.4. 再次执行测试，失败</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-FAQ"><span class="toc-number">10.</span> <span class="toc-text">常见问题 FAQ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#test-case-failed-%E5%8E%9F%E5%9B%A0"><span class="toc-number">10.1.</span> <span class="toc-text">test case failed 原因</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E8%B0%83%E8%AF%95"><span class="toc-number">11.</span> <span class="toc-text">异常调试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E6%97%A5%E5%BF%97"><span class="toc-number">11.1.</span> <span class="toc-text">分析日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#verbose-%E5%8F%82%E6%95%B0"><span class="toc-number">11.2.</span> <span class="toc-text">verbose 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debug-%E5%8F%82%E6%95%B0%E5%92%8C-gdb-%E5%8F%82%E6%95%B0"><span class="toc-number">11.3.</span> <span class="toc-text">debug 参数和 gdb 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E8%87%AA%E8%BA%AB%E6%94%AF%E6%8C%81-debug-%E5%8F%82%E6%95%B0"><span class="toc-number">11.4.</span> <span class="toc-text">脚本自身支持 debug 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#perl-%E7%9A%84%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.5.</span> <span class="toc-text">perl 的调试模式</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-4 i,
        .toc-level-4 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"true"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇　| DBKernel　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2023/05/01/mysql-mtr-02-advanced/" title="上一篇: 特性介绍 | MySQL 测试框架 MTR 系列教程（二）：进阶篇 - 内存/线程/代码覆盖率/单元/压力测试">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2022/07/06/StoneDB-an-integrated-real-time-HTAP-database/" title="下一篇: 推荐 | 一体化实时 HTAP 数据库 StoneDB，如何替换 MySQL 并实现近百倍性能提升">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/07/05/mysql-mtr-04-syntax/">特性介绍 | MySQL测试框架 MTR 系列教程（四）：语法篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/06/05/mysql-mtr-03-source-code/">源码分析 | MySQL测试框架 MTR 系列教程（三）：源码篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/05/04/mysql-threadpool-main-solutions-details/">业内 MySQL 线程池主流方案详解 - MariaDB/Percona/华为/AliSQL/TXSQL/MySQL企业版</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/05/01/mysql-mtr-02-advanced/">特性介绍 | MySQL 测试框架 MTR 系列教程（二）：进阶篇 - 内存/线程/代码覆盖率/单元/压力测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/18/mysql-mtr-01-introduction/">特性介绍 | MySQL 测试框架 MTR 系列教程（一）：入门篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/06/StoneDB-an-integrated-real-time-HTAP-database/">推荐 | 一体化实时 HTAP 数据库 StoneDB，如何替换 MySQL 并实现近百倍性能提升</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/08/19/how-to-choose-open-source-licence/">技术分享 | 如何为你的代码选择一个合适的开源协议？</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/26/clickhouse-and-friends-15-groupby/">源码分析 | ClickHouse和他的朋友们（15）Group By 为什么这么快</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/21/clickhouse-and-friends-14-compute-storage/">源码分析 | ClickHouse和他的朋友们（14）存储计算分离方案与实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/clickhouse-and-friends-13-replicated-merge-tree/">源码分析 | ClickHouse和他的朋友们（13）ReplicatedMergeTree表引擎及同步机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/03/clickhouse-and-friends-12-materialized-view/">源码分析 | ClickHouse和他的朋友们（12）神奇的物化视图(Materialized View)与原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/28/clickhouse-and-friends-11-mysql-gtid-replication/">源码分析 | ClickHouse和他的朋友们（11）MySQL实时复制之GTID模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/27/percona-xtrabackup-2.4-vs-8.0/">问题定位 | Peronca Xtrabackup 8.0近日踩坑总结 - xtrabackup 2.4和8.0区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/20/clickhouse-and-friends-10-merge-tree-wal/">源码分析 | ClickHouse和他的朋友们（10）MergeTree Write-Ahead Log</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/28/clickhouse-and-friends-09-mysql-replication/">源码分析 | ClickHouse和他的朋友们（9）MySQL实时复制与实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/26/clickhouse-and-friends-08-parser/">源码分析 | ClickHouse和他的朋友们 (８) 纯手工打造的SQL解析器</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/30/clickhouse-and-friends-06-merge-tree-disk-layout/">源码分析 | ClickHouse和他的朋友们（6）MergeTree存储结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/22/clickhouse-and-friends-05-merge-tree-algo/">源码分析 | ClickHouse和他的朋友们（5）存储引擎技术进化与MergeTree</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/12/clickhouse-and-friends-04-processor/">源码分析 | ClickHouse和他的朋友们（4）Pipeline处理器和调度器</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/08/clickhouse-and-friends-03-mysql-protocol-write-stack/">源码分析 | ClickHouse和他的朋友们（3）MySQL Protocol和Write调用栈</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/07/clickhouse-and-friends-02-mysql-protocol-read-stack/">源码分析 | ClickHouse和他的朋友们（2）MySQL Protocol和Read调用栈</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/05/clickhouse-and-friends-01-development/">源码分析 | ClickHouse和他的朋友们（1）编译、开发、测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/06/mysql-select-count-functions-01-concepts-and-differences/">特性介绍 | MySQL select count(*) 、count(1)、count(列) 详解（1）：概念及区别</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/06/mysql-try_acquire_lock_impl-crash-in-5720/">捉虫日记 | MySQL 5.7.20 try_acquire_lock_impl 异常导致mysql crash</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/09/mysql-auto_increment-details-01-concepts-and-usage/">特性介绍 | MySQL 自增列详解（1）：自增列概念及使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/22/mysql-memory-engine-slave-has-local-transactions/">引擎特性 | MySQL MEMORY(HEAP) 存储引擎导致 Slave 节点有本地事务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/16/process-for-starting-the-linux-os/">特性介绍 | Linux 操作系统启动流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/23/description-of-the-crontab-command/">实用工具 | Linux 定时任务 crontab 命令详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/21/greenplum-parallel-query-optimization-strategy/">特性分析 | GreenPlum 的并行查询优化策略详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/25/postgresql-error-wal-segment-has-already-been-removed/">问题定位 | PostgreSQL 报错 requested WAL segment has already been removed</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/test-postgresql-code-coverage-using-gcov-and-lcov/">源码分析 | 使用 gcov 和 lcov 测试 PostgreSQL 代码覆盖率</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/30/postgresql-regression-test-details/">源码分析 | PostgreSQL 回归测试详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/how-to-install-postgres-xc-on-linux/">最佳实践 | 源码编译安装配置 Postgres-XC 集群并用 pg_basebackup 配置 Datanode 热备</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/21/greenplum-primary-mirror-sync-mechanism/">特性分析 | GreenPlum Primary/Mirror 同步机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/14/how-to-install-greenplum-on-linux/">最佳实践 | CentOS 和 Ubuntu 下安装配置 GreenPlum 数据库集群 - 源码 & 安装包</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/23/example-of-postgresql-pgbench/">实用工具 | PostgreSQL 数据库压力测试工具 pgbench 使用示例</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/21/postgresql-primary-standby-streaming-replication/">特性分析 | PostgreSQL Primary/Standby 主备流复制机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/12/example-of-postgresql-libpq/">应用案例 | PostgreSQL libpq 网络库接口操作数据库示例</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/04/postgresql-dependency-constraint-details/">特性介绍 | PostgreSQL 的依赖约束详解 - 系统表 pg_depend & pg_constraint</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/04/c-compiler-memory-allocation-principles/">程序人生 | C 语言编译器对内存空间的分配原则</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/03/unix-getaddrinfo-function-detailed-usage/">程序人生 | unix 网络编程之 getaddrinfo 函数详解及使用举例</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/08/example-of-linux-daemon-program-design/">程序人生 | Linux Daemon 程序设计示例</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/05/how-to-install-configure-samba-service-in-ubuntu/">系统运维 | Ubuntu 下安装配置samba 服务的详细过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/04/c-traps-and-pitfalls-reading-notes/">程序人生 | 我的《C陷阱与缺陷》读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/07/21/c-language-byte-alignment-problem-in-detail-part-2/">程序人生 | C语言字节对齐问题详解 - 对齐/字节序/位序/网络序等（下）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/07/21/c-language-byte-alignment-problem-in-detail-part-1/">程序人生 | C语言字节对齐问题详解 - 对齐/字节序/位序/网络序等（上）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/07/10/makefile-common-templates/">程序人生 | Makefile 常用模板 - 静态链接库/动态链接库/可执行文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/07/10/advanced-programming-in-the-unix-environment-du/">程序人生 | UNIX环境高级编程技巧之 du 指令实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/07/10/advanced-programming-in-the-unix-environment-df/">程序人生 | UNIX环境高级编程技巧之 df 指令实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/12/linux-memory-management-parsing/">特性介绍 | Linux 内存管理机制解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/01/10/advanced-programming-in-the-unix-environment-getopt/">程序人生 | UNIX 环境高级编程技巧之 getopt & getopt_long 使用示例</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i>
                2014-2023 DBKernel
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <script src="/js/busuanzi.js"></script>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv">
                        <!--%= __('visit_counter.site_pv') %-->
                        <span id="site-visit" title="本站访问量">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                            <span id="busuanzi_value_site_pv"></span>
                        </span>
                    </span>
                    <span id="busuanzi_container_site_uv">
                        <!--%= __('visit_counter.site_uv') %-->
                        <span id="site-visit" title="本站访客数">
                            <i class="fa fa-user" aria-hidden="true"></i>
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv">
                        <!--%= __('visit_counter.page_pv') %-->
                        <span id="page-visit"  title="本页阅读量">
                            <i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                    <!--span id="busuanzi_container_page_uv">
                        <span id="page-visit"  title="本页访客数">
                            <i class="fa fa-user animated infinite pulse" aria-hidden="true"></i>
                            <span id="busuanzi_value_page_uv"></span>
                        </span>
                    </span-->
                
            </div>
        
    </div>
</footer>
    </div>
    
    
<script src="/js/GithubRepoWidget.js"></script>


<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
             post: ".article-entry a[href], .copyright a[href]", 
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>